#!/bin/bash

set -e -f -u -o pipefail

if [[ -z "${CAFFEINATED:-}" ]]; then
  CAFFEINATED="do not sleep"
  export CAFFEINATED
  exec caffeinate -i "$0"
fi

# dotfiles and bin are the next most likely source of diffs, and they can be
# fixed mostly automatically.
printf "\\n\\n\\ndotfiles\\n"
run-everywhere update-dotfiles-and-bin
# Run a second time so that commits from later machines are pulled to earlier
# machines.
run-everywhere update-dotfiles-and-bin

# Now do the rest of the checks.
# shellcheck disable=SC2016
run-everywhere --users johntobin 'check-git-repos "${HOME}/bin" "${HOME}/src/"*'
