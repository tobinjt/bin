#!/bin/bash

set -e -f -u -o pipefail

# Update homebrew and list packages that are out of date.
PATH="/usr/local/bin:/usr/local/sbin:$PATH"
export PATH
cd /usr/local/Homebrew
# Disable automatic git gc and run it manually to prevent output about
# automatically running it.  Sadly disabling it doesn't actually work, git still
# runs it and spews a warning about it.  Annoying.
git config --local gc.auto 0
git config --local gc.autoDetach false
git gc --quiet
# Try to filter spam output by git.
brew update 2>&1 > /dev/null \
  | grep -v -e 'Successfully rebased and updated' -e '^$' || true
git gc --quiet
brew outdated
brew outdated --cask
brew doctor | grep -v 'Your system is ready to brew.' || true
