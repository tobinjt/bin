#!/bin/bash

set -e -f -u -o pipefail

cd "${HOME}/Downloads/warhammer/"
# Only update brew if it's been at least 4 hours since the last update.
old_dir="$(find /usr/local/Homebrew/ -maxdepth 1 -name .git -cmin 240)"
if [[ -n "${old_dir}" ]]; then
  printf "Updating homebrew to check for new version of youtube-dl\\n"
  brew update
  if brew outdated | grep youtube-dl; then
    printf "Updating youtube-dl\\n"
    brew upgrade youtube-dl
  fi
fi
until /usr/local/bin/youtube-dl "$@"; do
  sleep 10
done
